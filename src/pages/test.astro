---
import Layout from '../layouts/Layout.astro';
import Live2DCanvas from '../components/Live2DCanvas.astro';
import MainInput from '../components/chat/Main_input.astro';
import Subtitles from '../components/Subtitles.astro';
---

<Layout title="WebSocket Client">
      <div class="layout">
        <aside class="sidebar">
          <button id="toggleBtn" onclick="  const sidebar = document.querySelector('.sidebar');
          sidebar.classList.toggle('expanded');">‚ò∞</button>
          <nav>
            <a href="#">üè†</a>
            <a href="#">üìÑ</a>
            <a href="#">‚öôÔ∏è</a>
          </nav>
        </aside>

        <main class="grid">
              <Live2DCanvas />
                  <div id="video-player" class="relative w-full max-w-4xl mx-auto aspect-video bg-gray-900 rounded-lg shadow-xl text-white flex items-center justify-center">
            <p class="text-2xl text-gray-500">[ Simulaci√≥n de un reproductor de video ]</p>
        </div>

              <footer class="footer p-2">
                <MainInput label="Chat" />
              </footer>
        </main>

      </div>
</Layout>
<style>
.layout {
  display: grid;
  grid-template-columns: auto 1fr; /* Sidebar + contenido */
  grid-template-rows: 100vh; /* Ocupa toda la altura */
}

.sidebar {
  background: #1e1e2f;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  padding: 10px 0;
  width: 70px; /* Colapsado */
  overflow: hidden;
  transition: width 0.3s ease;
}

.sidebar.expanded {
  width: 250px; /* Expandido */
}

.sidebar button {
  background: none;
  border: none;
  color: white;
  font-size: 1.8rem;
  margin: 10px;
  cursor: pointer;
}

.sidebar nav {
  margin-top: 20px;
  width: 100%;
}

.sidebar nav a {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 15px;
  color: white;
  text-decoration: none;
  font-size: 1.1rem;
  white-space: nowrap;
}

.sidebar nav a:hover {
  background: #333;
}

.sidebar nav a span {
  opacity: 0;
  transition: opacity 0.3s ease;
}

.sidebar.expanded nav a span {
  opacity: 1;
}
</style>
<script>
    import { emitter } from '../lib/Emitter';

    // Funci√≥n para a√±adir listeners a los botones
    function setupControls() {
        // --- Controles B√°sicos ---
        document.getElementById('show-btn')?.addEventListener('click', () => {
            emitter.emit('subtitles:show', { text: '¬°Hola! Este es un <b>subt√≠tulo</b> permanente.' });
        });

        document.getElementById('show-timed-btn')?.addEventListener('click', () => {
            emitter.emit('subtitles:show', { text: 'Este mensaje desaparecer√° en 3 segundos.', duration: 3000 });
        });

        document.getElementById('hide-btn')?.addEventListener('click', () => {
            emitter.emit('subtitles:hide');
        });

        // --- Controles de Posici√≥n ---
        document.getElementById('move-top-btn')?.addEventListener('click', () => {
            emitter.emit('subtitles:move', { 
                top: '5%', 
                bottom: 'auto',
                left: '50%',
                transform: 'translateX(-50%)'
            });
        });

        document.getElementById('move-bottom-btn')?.addEventListener('click', () => {
            emitter.emit('subtitles:move', { 
                bottom: '10%', 
                top: 'auto',
                left: '50%',
                transform: 'translateX(-50%)'
            });
        });

        // --- Controles de Estilo ---
        document.getElementById('style-warning-btn')?.addEventListener('click', () => {
            emitter.emit('subtitles:configure', { 
                backgroundColor: 'rgba(234, 179, 8, 0.8)', // yellow-500 con opacidad
                color: 'black',
                fontSize: '20px',
                fontWeight: 'bold'
            });
        });

        document.getElementById('style-default-btn')?.addEventListener('click', () => {
            emitter.emit('subtitles:configure', { 
                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                color: 'white',
                fontSize: '18px',
                fontWeight: 'normal'
            });
        });
    }

    // Aseguramos que el DOM est√© cargado antes de a√±adir los listeners
    document.addEventListener('DOMContentLoaded', setupControls);
</script>